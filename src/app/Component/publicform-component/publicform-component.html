<header class="pf-header">
  <div class="head-center">
    <h1 class="title">QuestIO</h1>
  </div>
</header>

<main class="pf-page">

  <!-- 1. LOADING (Adicionado para n√£o ficar tela branca) -->
  <div *ngIf="mode === 'loading'" class="pf-card" style="text-align: center; padding: 40px;">
    <p>üîÑ Carregando pesquisa...</p>
  </div>

  <!-- 2. ERRO (Adicionado para avisar se o link expirou) -->
  <div *ngIf="mode === 'error'" class="pf-card" style="text-align: center; padding: 40px; color: #d32f2f;">
    <h3>‚ö†Ô∏è Ops!</h3>
    <p>{{ errorMessage }}</p>
  </div>

  <!-- CONTE√öDO PRINCIPAL (S√≥ aparece se n√£o estiver carregando nem com erro) -->
  <ng-container *ngIf="mode !== 'loading' && mode !== 'error'">
    
    <div class="pf-hotel">{{ formTitle }}</div>
    <div class="pf-form-desc" *ngIf="formDescription">{{ formDescription }}</div>

    <!-- Barra de Progresso (Chips) -->
    <div class="pf-chips" *ngIf="mode === 'form'">
      <button 
        *ngFor="let b of blocks; let i = index" 
        class="chip" 
        [class.done]="i < idx" 
        [class.current]="i === idx"
        aria-label="passo {{ i + 1 }}">
      </button>
    </div>

    <!-- CART√ÉO DA PERGUNTA -->
    <section class="pf-card" *ngIf="mode === 'form' && current as b">
      <div class="pf-card-title">
        {{ b.title }}
        <span *ngIf="b.required" style="color:red; margin-left:4px">*</span>
      </div>

      <ng-container [ngSwitch]="b.type">

        <!-- STICKER -->
        <ul class="pf-sticker" *ngSwitchCase="'sticker'">
          <li (click)="selectSticker(b.id, 1)" [class.on]="answers[b.id] === 1">
            <span>üò´</span><small>P√âSSIMA</small>
          </li>
          <li (click)="selectSticker(b.id, 2)" [class.on]="answers[b.id] === 2">
            <span>‚òπÔ∏è</span><small>RUIM</small>
          </li>
          <li (click)="selectSticker(b.id, 3)" [class.on]="answers[b.id] === 3">
            <span>üòê</span><small>REGULAR</small>
          </li>
          <li (click)="selectSticker(b.id, 4)" [class.on]="answers[b.id] === 4">
            <span>üôÇ</span><small>BOA</small>
          </li>
          <li (click)="selectSticker(b.id, 5)" [class.on]="answers[b.id] === 5">
            <span>üòÑ</span><small>EXCELENTE</small>
          </li>
        </ul>

        <!-- BAR (Slider) -->
        <div class="pf-slider-wrap" *ngSwitchCase="'bar'">
          <input class="pf-slider" type="range" min="1" max="5" step="1" 
                 [value]="answers[b.id] || 3" 
                 (input)="onSlider(b.id, $event)" />
          <div class="pf-slider-scale">
            <span>1</span><span>2</span><span>3</span><span>4</span><span>5</span>
          </div>
        </div>

        <!-- STARS -->
        <div class="pf-stars" *ngSwitchCase="'stars'">
          <button type="button" 
                  *ngFor="let s of [1,2,3,4,5]" 
                  class="star" 
                  [class.on]="(answers[b.id] || 0) >= s"
                  (click)="selectStars(b.id, s)" 
                  aria-label="estrela {{s}}">
            ‚òÖ
          </button>
        </div>

        <!-- TEXT -->
        <div *ngSwitchCase="'text'">
          <textarea class="pf-text" rows="4" 
                    placeholder="Escreva sua resposta..." 
                    [ngModel]="answers[b.id]"
                    (ngModelChange)="onText(b.id, $event)">
          </textarea>
        </div>

      </ng-container>
    </section>

    <!-- BOT√ÉO DE CONFIRMAR -->
    <div class="pf-actions" *ngIf="mode === 'form'">
      <button class="pf-btn" (click)="confirm()">CONFIRMAR</button>
    </div>

    <!-- MENSAGEM DE ERRO (Required) -->
    <div class="pf-error" *ngIf="mode === 'form' && requiredError">
      Por favor, responda esta pergunta antes de avan√ßar.
    </div>

    <!-- TELA DE REVIS√ÉO -->
    <section class="pf-review" *ngIf="mode === 'review'">
      <div class="pf-hotel pf-review-title">{{ hotel }}</div>
      <ul class="pf-review-list">
        <li *ngFor="let b of blocks">
          <span class="tick">‚úì</span>
          <span class="lbl">{{ b.title }}</span>
          <!-- Mostra um preview da resposta se quiser -->
          <!-- <span class="val">{{ answers[b.id] }}</span> -->
        </li>
      </ul>
      <div class="pf-actions pf-actions-review">
        <button class="pf-btn" (click)="finish()">FINALIZAR</button>
      </div>
    </section>

    <!-- TELA DE AGRADECIMENTO -->
    <section class="pf-done" *ngIf="mode === 'done'">
      <div class="pf-brand big">{{ brand }}</div>
      <div class="pf-thanks">
        <div class="hotel">{{ hotel }}</div>
        <div class="icon">üè®</div>
        <div class="msg">AGRADECE A PREFER√äNCIA</div>
        <div class="foot">PESQUISA RESPONDIDA EM {{ doneAt }}</div>
      </div>
    </section>

  </ng-container>
</main>